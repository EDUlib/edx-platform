<%!
  import json
  from django.utils.translation import ugettext as _
  from openedx.core.djangolib.js_utils import dump_js_escaped_json
  from xmodule.modulestore.django import modulestore
  from xmodule.contentstore.django import contentstore
  from microsite_configuration import microsite
%>
<%inherit file="../main.html" />
<%
  course_discovery_enabled = settings.FEATURES.get('ENABLE_COURSE_DISCOVERY')
%>

<%! from django.core.urlresolvers import reverse %>

<%inherit file="../main.html"/>
<%namespace name='static' file='../static_content.html'/>

% if course_discovery_enabled:
<%block name="header_extras">
  % for template_name in ["course_card", "filter_bar", "filter", "facet", "facet_option"]:
  <script type="text/template" id="${template_name}-tpl">
      <%static:include path="discovery/${template_name}.underscore" />
  </script>
  % endfor
  <%static:require_module module_name="js/discovery/discovery_factory" class_name="DiscoveryFactory">
    DiscoveryFactory(
      ${course_discovery_meanings | n, dump_js_escaped_json},
      getParameterByName('search_query'),
      "${user_language}",
      "${user_timezone}"
    );
  </%static:require_module>
</%block>
% endif

<%block name="pagetitle">${_("Courses")}</%block>
<%
  platform_name = microsite.get_value('platform_name', settings.PLATFORM_NAME)
  course_discovery_enabled = settings.FEATURES.get('ENABLE_COURSE_DISCOVERY')
  if self.stanford_theme_enabled():
    course_index_overlay_text = _("Explore free courses from {university_name}.").format(university_name="Stanford University")
    logo_file = static.url('themes/stanford/images/seal.png')
    logo_alt_text = "Stanford Seal Logo"

<main id="main" aria-label="Content" tabindex="-1">

    <section class="home">
    <section class="container edulib">
    
        %if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
            <% counter = 0 %>
        %endif

        <% for course in sorted(modulestore().get_courses(), key=lambda x: (x.start is None, x.start), reverse=False):
               if not course.has_started() and course.catalog_visibility == "both" :
                  counter += 1
        %>

        %if counter !=0 :
            <h1>${_("Coming Soon")}</h1>
        %endif

        <section class="courses-container">
        <section class="highlighted-courses">
            <section class="courses">
               <ul class="courses-listing">
                   %for course in sorted(modulestore().get_courses(), key=lambda x: (x.start is None, x.start), reverse=False):
                        %if not course.has_started() and course.catalog_visibility == "both" :
                            <li class="courses-listing-item">
                                <%include file="../course-edulib.html" args="course=course" />
                            </li>
                        %endif
                   %endfor
               </ul>
            </section>
        </section>
        </section>

        %if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
            <% counter = 0 %>
        %endif

        <% for course in sorted(modulestore().get_courses(),key=lambda x: (x.start is None, x.start), reverse=False):
               if course.has_started() and not course.has_ended() and course.catalog_visibility == "both" :
                  counter += 1
        %>

        %if counter !=0 :
            <h1>${_("In Progress")}</h1>
        %endif

        <section class="courses-container">
        <section class="highlighted-courses">
            <section class="courses">
               <ul class="courses-listing">

                   %for course in sorted(modulestore().get_courses(), key=lambda x: (x.start is None, x.start), reverse=False):
                        %if course.has_started() and not course.has_ended() and (course.end is not None) and course.catalog_visibility=="both":
                            <li class="courses-listing-item">
                                <%include file="../course-edulib.html" args="course=course" />
                            </li>
                        %endif
                   %endfor
                   %for course in sorted(modulestore().get_courses(), key=lambda x: (x.start is None, x.start), reverse=True):
                        %if course.has_started() and not course.has_ended() and not (course.end is not None) and course.catalog_visibility=="both":
                            <li class="courses-listing-item">
                                <%include file="../course-edulib.html" args="course=course" />
                            </li>
                        %endif
                   %endfor

               </ul>
            </section>
        </section>

        %if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
            <% counter  = 0  %>
        %endif
    
        <% for course in sorted(modulestore().get_courses(),key=lambda x: (x.end is None, x.end), reverse=True):
               if course.has_ended() and course.catalog_visibility == "both" :
                  counter += 1
        %>

        %if counter !=0 :
            <h1>${_("Completed")}</h1>
        %endif

        <section class="courses-container">
        <section class="highlighted-courses">
            <section class="courses">
               <ul class="courses-listing">
                   %for course in sorted(modulestore().get_courses(),key=lambda x: (x.end is None, x.end), reverse=True):
                        %if course.has_ended() and course.catalog_visibility == "both" :
                            <li class="courses-listing-item">
                                <%include file="../course-edulib.html" args="course=course" />
                            </li>
                        %endif
                   %endfor
               </ul>
            </section>
        </section>
        </section>

    </section>
    </section>

</main>
